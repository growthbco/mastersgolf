---
import Layout from '../../layouts/Layout.astro';
import inventoryData from '../../data/inventory.json';

export async function getStaticPaths() {
	return inventoryData.map((cart) => ({
		params: { id: cart.id },
		props: { cart },
	}));
}

const { cart } = Astro.props;
---

<Layout title={`${cart.name} - Stock #${cart.stock} - Masters Golf Cars`} description={`${cart.name} for sale at Masters Golf Cars. Stock #${cart.stock}. Sale Price: $${(cart.salePrice || cart.price).toLocaleString()}`}>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<script> window.FontAwesomeConfig = { autoReplaceSvg: 'nest'};</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<div id="inventory-page" class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
		<div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
			
			<!-- Filters Sidebar -->
			<aside id="filters-sidebar" class="lg:col-span-1">
				<div class="space-y-6">
					<div id="filter-header">
						<h1 class="text-3xl font-bold text-gray-900">Inventory Filter</h1>
						<p class="text-lg text-gray-600">Selection</p>
					</div>
					
					<!-- Keyword Filter -->
					<div id="filter-keyword" class="border-b pb-6">
						<button class="w-full flex justify-between items-center text-left py-2" onclick="toggleFilter('keyword-content')">
							<h3 class="text-lg font-semibold text-gray-900">Keyword Or Stock #</h3>
							<i id="keyword-toggle-icon" class="fa-solid fa-chevron-up text-gray-500"></i>
						</button>
						<div id="keyword-content" class="mt-4">
							<div class="flex">
								<input type="text" placeholder="Keyword Or Stock #" class="flex-grow border border-gray-300 rounded-l-md px-4 py-2 focus:ring-brand-green focus:border-brand-green outline-none">
								<button class="bg-gray-900 text-white px-4 py-2 rounded-r-md hover:bg-gray-800">
									<i class="fa-solid fa-search"></i>
								</button>
							</div>
						</div>
					</div>
					
					<!-- Brand/Model Filter -->
					<div id="filter-brand" class="border-b pb-6">
						<button class="w-full flex justify-between items-center text-left py-2" onclick="toggleFilter('brand-content')">
							<h3 class="text-lg font-semibold text-gray-900">Brand/Model</h3>
							<i id="brand-toggle-icon" class="fa-solid fa-chevron-up text-gray-500"></i>
						</button>
						<div id="brand-content" class="mt-4 space-y-3">
							<div class="flex justify-between items-center text-gray-600">
								<a href="/inventory" class="hover:text-brand-green">Any</a>
								<span class="bg-gray-200 text-gray-700 text-xs font-semibold px-2 py-1 rounded-full">{inventoryData.length}</span>
							</div>
							<div class="flex justify-between items-center text-brand-green font-semibold">
								<a href="/inventory" class="flex items-center">
									<i class="fa-solid fa-chevron-down mr-2 text-xs"></i>
									Advanced EV
								</a>
								<span class="bg-gray-200 text-gray-700 text-xs font-semibold px-2 py-1 rounded-full">{inventoryData.length}</span>
							</div>
						</div>
					</div>
					
					<!-- Price Filter -->
					<div id="filter-price" class="border-b pb-6">
						<button class="w-full flex justify-between items-center text-left py-2" onclick="toggleFilter('price-content')">
							<h3 class="text-lg font-semibold text-gray-900">Price</h3>
							<i id="price-toggle-icon" class="fa-solid fa-chevron-up text-gray-500"></i>
						</button>
						<div id="price-content" class="mt-4">
							<div class="flex items-center space-x-2">
								<input type="text" placeholder="Min" class="w-full border border-gray-300 rounded-md px-4 py-2 text-center focus:ring-brand-green focus:border-brand-green outline-none">
								<span class="text-gray-500">TO</span>
								<input type="text" placeholder="Max" class="w-full border border-gray-300 rounded-md px-4 py-2 text-center focus:ring-brand-green focus:border-brand-green outline-none">
							</div>
						</div>
					</div>
					
					<!-- Update Button -->
					<div id="filter-update-button">
						<a href="/inventory" class="block w-full bg-gray-900 text-white font-bold py-3 px-4 rounded-md hover:bg-gray-800 transition-colors text-center">
							UPDATE
						</a>
					</div>
				</div>
			</aside>
			
			<!-- Product Detail -->
			<main id="product-grid-section" class="lg:col-span-3">
				<div id="grid-controls" class="flex justify-between items-center mb-4 pb-4 border-b">
					<a href="/inventory" class="text-brand-green hover:underline flex items-center gap-2">
						<i class="fa-solid fa-arrow-left"></i>
						<span>Back to Inventory</span>
					</a>
				</div>
				
				<div id="grid-header" class="bg-gray-900 text-white text-xl font-bold p-4 mb-6">
					<h2>Golf Cart</h2>
				</div>
				
				<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
					<!-- Product Image -->
					<div class="border border-gray-200 rounded-lg overflow-hidden">
						<img class="w-full h-auto object-contain" src={cart.image} alt={cart.name} />
					</div>
					
					<!-- Product Details -->
					<div class="space-y-6">
						<div>
							<h1 class="text-3xl font-bold text-gray-900 mb-4">{cart.name}</h1>
							<div class="space-y-2">
								<p class="text-gray-600">Stock # <span class="font-bold text-gray-900">{cart.stock}</span></p>
								<p class="text-gray-600">Brand: <span class="font-bold text-gray-900">{cart.brand}</span></p>
								<p class="text-gray-600">Model: <span class="font-bold text-gray-900">{cart.model}</span></p>
								<p class="text-gray-600">Year: <span class="font-bold text-gray-900">{cart.year}</span></p>
							</div>
						</div>
						
						<div class="border-t border-b py-6">
							<p class="text-gray-600 mb-2">Sale Price</p>
							<p class="text-4xl font-bold text-gray-900">${(cart.salePrice || cart.price).toLocaleString()}</p>
							{cart.salePrice && (
								<p class="text-gray-500 line-through mt-2">${cart.price.toLocaleString()}</p>
							)}
						</div>
						
						<div class="space-y-3">
							<button 
								id="detail-email-button"
								data-stock={cart.stock} 
								data-cart-name={cart.name}
								class="w-full bg-gray-900 text-white font-semibold py-3 px-4 rounded-md hover:bg-gray-800 transition-colors flex items-center justify-center space-x-2">
								<i class="fa-regular fa-envelope"></i>
								<span>SEND EMAIL</span>
							</button>
							<a href="tel:3523070111" class="block w-full bg-white text-gray-900 font-semibold py-3 px-4 rounded-md border-2 border-brand-green hover:bg-green-50 transition-colors text-center">
								<i class="fa-solid fa-phone mr-2"></i>
								CALL (352) 307-0111
							</a>
						</div>
					</div>
				</div>
			</main>
		</div>
	</div>

	<!-- Email Modal -->
	<div id="email-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
		<div class="bg-white rounded-lg max-w-md w-full p-6 relative">
			<button onclick="closeEmailModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
				<i class="fa-solid fa-times text-xl"></i>
			</button>
			<h2 class="text-2xl font-bold text-gray-900 mb-4">Send Email Inquiry</h2>
			<form name="cart-inquiry" method="POST" data-netlify="true" netlify-honeypot="bot-field" class="space-y-4">
				<input type="hidden" name="form-name" value="cart-inquiry" />
				<input type="hidden" name="stock-number" id="modal-stock-number" />
				<input type="hidden" name="cart-name" id="modal-cart-name" />
				<p class="hidden">
					<label>Don't fill this out: <input name="bot-field" /></label>
				</p>
				<div>
					<label for="modal-name" class="block text-sm font-semibold text-gray-700 mb-1">Name *</label>
					<input type="text" id="modal-name" name="name" required class="w-full border border-gray-300 rounded-md px-4 py-2 focus:ring-brand-green focus:border-brand-green outline-none">
				</div>
				<div>
					<label for="modal-email" class="block text-sm font-semibold text-gray-700 mb-1">Email *</label>
					<input type="email" id="modal-email" name="email" required class="w-full border border-gray-300 rounded-md px-4 py-2 focus:ring-brand-green focus:border-brand-green outline-none">
				</div>
				<div>
					<label for="modal-phone" class="block text-sm font-semibold text-gray-700 mb-1">Phone *</label>
					<input type="tel" id="modal-phone" name="phone" required class="w-full border border-gray-300 rounded-md px-4 py-2 focus:ring-brand-green focus:border-brand-green outline-none">
				</div>
				<div>
					<label for="modal-message" class="block text-sm font-semibold text-gray-700 mb-1">Message *</label>
					<textarea id="modal-message" name="message" rows="4" required class="w-full border border-gray-300 rounded-md px-4 py-2 focus:ring-brand-green focus:border-brand-green outline-none"></textarea>
				</div>
				<div class="flex gap-3">
					<button type="submit" class="flex-1 bg-brand-green text-white font-semibold py-3 px-4 rounded-md hover:opacity-90 transition-colors">
						SEND EMAIL
					</button>
					<button type="button" onclick="closeEmailModal()" class="flex-1 bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-md hover:bg-gray-300 transition-colors">
						CANCEL
					</button>
				</div>
			</form>
		</div>
	</div>

	<script>
		function toggleFilter(contentId) {
			const content = document.getElementById(contentId);
			const iconId = contentId.split('-')[0] + '-toggle-icon';
			const icon = document.getElementById(iconId);
			
			if (content.style.display === 'none' || content.style.display === '') {
				content.style.display = 'block';
				icon.classList.remove('fa-chevron-down');
				icon.classList.add('fa-chevron-up');
			} else {
				content.style.display = 'none';
				icon.classList.remove('fa-chevron-up');
				icon.classList.add('fa-chevron-down');
			}
		}

		function openEmailModal(stockNumber, cartName) {
			document.getElementById('modal-stock-number').value = stockNumber;
			document.getElementById('modal-cart-name').value = cartName;
			document.getElementById('email-modal').classList.remove('hidden');
			document.body.style.overflow = 'hidden';
		}

		function closeEmailModal() {
			document.getElementById('email-modal').classList.add('hidden');
			document.body.style.overflow = '';
		}

		// Close modal when clicking outside
		document.getElementById('email-modal').addEventListener('click', function(e) {
			if (e.target === this) {
				closeEmailModal();
			}
		});

		// Initially set the filters to be open
		document.addEventListener('DOMContentLoaded', function() {
			document.getElementById('keyword-content').style.display = 'block';
			document.getElementById('brand-content').style.display = 'block';
			document.getElementById('price-content').style.display = 'block';
			
			// Add click handler to email button
			const emailButton = document.getElementById('detail-email-button');
			if (emailButton) {
				emailButton.addEventListener('click', function() {
					const stockNumber = this.getAttribute('data-stock');
					const cartName = this.getAttribute('data-cart-name');
					openEmailModal(stockNumber, cartName);
				});
			}
		});
	</script>
</Layout>

