---
import Layout from '../layouts/Layout.astro';
import inventoryData from '../data/inventory.json';

export async function getStaticPaths() {
	return inventoryData
		.filter(cart => cart.slug)
		.map((cart) => ({
			params: { slug: cart.slug },
			props: { cart, slug: cart.slug },
		}));
}

const { cart, slug } = Astro.props;
const cartImages = cart.images && cart.images.length > 0 ? cart.images : [cart.image];
const currentUrl = `https://mastersgolf.netlify.app/${slug}`;
---

<Layout title={`${cart.name} - Stock #${cart.stock} - Masters Golf Cars`} description={`${cart.name} for sale at Masters Golf Cars. Stock #${cart.stock}. Sale Price: $${(cart.salePrice || cart.price).toLocaleString()}`}>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<script> window.FontAwesomeConfig = { autoReplaceSvg: 'nest'};</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-2">
		<!-- Product Header -->
		<div class="mb-2">
			<div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-2 mb-2">
				<div class="flex-1">
					<h1 class="text-xl md:text-2xl font-black text-gray-900 mb-0.5 uppercase">NEW {cart.name}</h1>
					<p class="text-gray-600 mb-1 text-sm">{cart.year} {cart.brand} {cart.model} Passenger Deluxe Golf Ready</p>
					<div class="flex flex-wrap gap-2">
						<span class="bg-brand-green text-white px-3 py-1 rounded-full text-xs font-bold">SALE!</span>
						<span class="bg-orange-500 text-white px-3 py-1 rounded-full text-xs font-bold">âœ” IN STOCK</span>
					</div>
				</div>
				<div class="flex flex-col items-start lg:items-end gap-1.5">
					<a href="tel:3523070111" class="bg-brand-green text-white px-5 py-2 rounded-md text-sm font-semibold hover:opacity-90 transition flex items-center gap-2">
						<i class="fa-solid fa-phone"></i>
						352-307-0111
					</a>
					<div class="flex items-center gap-2">
						<span class="text-gray-600 text-sm">Share:</span>
						<a href={`https://www.facebook.com/sharer/sharer.php?u=${currentUrl}`} target="_blank" class="text-blue-600 hover:text-blue-700 transition">
							<i class="fa-brands fa-facebook text-lg"></i>
						</a>
						<a href={`https://pinterest.com/pin/create/button/?url=${currentUrl}`} target="_blank" class="text-red-600 hover:text-red-700 transition">
							<i class="fa-brands fa-pinterest text-lg"></i>
						</a>
						<a href={`https://twitter.com/intent/tweet?url=${currentUrl}`} target="_blank" class="text-black hover:text-gray-800 transition">
							<i class="fa-brands fa-x-twitter text-lg"></i>
						</a>
					</div>
				</div>
			</div>
		</div>

		<div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
			<!-- Left Column - Image Gallery -->
			<div class="lg:col-span-2">
				<div class="mb-1">
					<p class="text-xs font-semibold text-gray-700">PHOTOS ({cartImages.length})</p>
				</div>
				<div class="relative mb-3">
					<div class="border border-gray-200 rounded-lg overflow-hidden relative flex justify-center bg-gray-50">
						<img id="main-image" src={cartImages[0]} alt={cart.name} class="max-w-full max-h-[500px] h-auto object-contain" width="800" height="600" />
						<button id="show-all-photos" class="absolute bottom-3 left-3 bg-black bg-opacity-70 text-white px-3 py-1.5 rounded-md hover:bg-opacity-90 transition flex items-center gap-2 text-sm">
							<i class="fa-solid fa-th"></i>
							<span>Show All {cartImages.length} Photos</span>
						</button>
					</div>
				</div>
				<!-- Thumbnail Gallery - Show All 7 Photos -->
				<div class="grid grid-cols-7 gap-2">
					{cartImages.map((img, index) => (
						<button 
							class="thumbnail-btn border-2 border-transparent hover:border-brand-green rounded-lg overflow-hidden transition"
							data-image={img}
							data-index={index}
						>
							<img src={img} alt={`${cart.name} - Image ${index + 1}`} class="w-full h-20 object-cover" />
						</button>
					))}
				</div>
			</div>

			<!-- Right Column - Pricing First, Then Form -->
			<div class="space-y-4">
				<!-- Pricing -->
				<div class="bg-gray-50 rounded-lg p-4">
					<div class="text-right">
						<p class="text-gray-600 text-xs mb-1">PRICE</p>
						<p class="text-xl font-bold text-gray-400 line-through">${cart.price.toLocaleString()}</p>
						<p class="text-gray-600 text-xs mt-2 mb-1">SALE PRICE</p>
						<p class="text-3xl font-black text-gray-900">${cart.salePrice.toLocaleString()}</p>
					</div>
				</div>

				<!-- Request More Info Form -->
				<div class="bg-gray-900 text-white rounded-lg p-4">
					<h2 class="text-lg font-bold mb-3">REQUEST MORE INFO</h2>
					<form name="cart-inquiry" method="POST" data-netlify="true" netlify-honeypot="bot-field" action="/success" class="space-y-3">
						<input type="hidden" name="form-name" value="cart-inquiry" />
						<input type="hidden" name="stock-number" value={cart.stock} />
						<input type="hidden" name="cart-name" value={cart.name} />
						<p class="hidden">
							<label>Don't fill this out: <input name="bot-field" /></label>
						</p>
						<div>
							<label for="first-name" class="block text-xs font-semibold mb-1">First Name *</label>
							<input type="text" id="first-name" name="first-name" required class="w-full border border-gray-600 rounded-md px-3 py-2 text-sm bg-gray-800 text-white focus:ring-brand-green focus:border-brand-green outline-none">
						</div>
						<div>
							<label for="last-name" class="block text-xs font-semibold mb-1">Last Name *</label>
							<input type="text" id="last-name" name="last-name" required class="w-full border border-gray-600 rounded-md px-3 py-2 text-sm bg-gray-800 text-white focus:ring-brand-green focus:border-brand-green outline-none">
						</div>
						<div>
							<label for="email" class="block text-xs font-semibold mb-1">Email *</label>
							<input type="email" id="email" name="email" required class="w-full border border-gray-600 rounded-md px-3 py-2 text-sm bg-gray-800 text-white focus:ring-brand-green focus:border-brand-green outline-none">
						</div>
						<div>
							<label for="phone" class="block text-xs font-semibold mb-1">Phone Number</label>
							<input type="tel" id="phone" name="phone" class="w-full border border-gray-600 rounded-md px-3 py-2 text-sm bg-gray-800 text-white focus:ring-brand-green focus:border-brand-green outline-none">
						</div>
						<div>
							<label for="comments" class="block text-xs font-semibold mb-1">Comments</label>
							<textarea id="comments" name="comments" rows="3" class="w-full border border-gray-600 rounded-md px-3 py-2 text-sm bg-gray-800 text-white focus:ring-brand-green focus:border-brand-green outline-none"></textarea>
						</div>
						<label class="flex items-center gap-2 text-xs">
							<input type="checkbox" name="email-list" class="h-3 w-3 rounded border-gray-600 text-brand-green focus:ring-brand-green bg-gray-800">
							<span>Please add me to your email list!</span>
						</label>
						<button type="submit" class="w-full bg-brand-green text-white font-bold py-2.5 px-4 rounded-md hover:opacity-90 transition-colors text-sm">
							SEND
						</button>
						<p class="text-xs text-gray-400 text-center mt-2">
							This site is protected by reCAPTCHA and the Google <a href="https://policies.google.com/privacy" target="_blank" class="underline">Privacy Policy</a> and <a href="https://policies.google.com/terms" target="_blank" class="underline">Terms of Service</a> apply.
						</p>
					</form>
				</div>

				<!-- Action Buttons -->
				<div class="space-y-2">
					<a href="/contact" class="block w-full bg-brand-green text-white font-semibold py-2.5 px-4 rounded-md hover:opacity-90 transition text-center text-sm">
						<i class="fa-solid fa-dollar-sign mr-2"></i>
						CREDIT APPLICATION
					</a>
					<a href="/contact" class="block w-full bg-brand-green text-white font-semibold py-2.5 px-4 rounded-md hover:opacity-90 transition text-center text-sm">
						<i class="fa-solid fa-map-marker-alt mr-2"></i>
						FIND US
					</a>
					<a href="/contact" class="block w-full bg-brand-green text-white font-semibold py-2.5 px-4 rounded-md hover:opacity-90 transition text-center text-sm">
						<i class="fa-solid fa-calculator mr-2"></i>
						CALCULATE PAYMENT
					</a>
					<a href={`mailto:?subject=${encodeURIComponent(cart.name)}&body=${encodeURIComponent(`Check out this golf cart: ${currentUrl}`)}`} class="block w-full bg-brand-green text-white font-semibold py-2.5 px-4 rounded-md hover:opacity-90 transition text-center text-sm">
						<i class="fa-regular fa-envelope mr-2"></i>
						EMAIL TO FRIEND
					</a>
					<button onclick="window.print()" class="w-full bg-brand-green text-white font-semibold py-2.5 px-4 rounded-md hover:opacity-90 transition text-sm">
						<i class="fa-solid fa-print mr-2"></i>
						PRINT UNIT INFO
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Photo Gallery Modal -->
	<div id="photo-modal" class="fixed inset-0 bg-black bg-opacity-90 hidden z-50 flex items-center justify-center p-4">
		<div class="max-w-6xl w-full relative">
			<button id="close-photo-modal" class="absolute top-4 right-4 text-white hover:text-gray-300 z-10">
				<i class="fa-solid fa-times text-3xl"></i>
			</button>
			<div class="mb-4">
				<img id="modal-main-image" src={cartImages[0]} alt={cart.name} class="w-full h-auto max-h-[80vh] object-contain mx-auto" />
			</div>
			<div class="grid grid-cols-7 gap-2 max-w-4xl mx-auto">
				{cartImages.map((img, index) => (
					<button 
						class="modal-thumbnail border-2 border-transparent hover:border-brand-green rounded-lg overflow-hidden transition"
						data-image={img}
					>
						<img src={img} alt={`${cart.name} - Image ${index + 1}`} class="w-full h-20 object-cover" />
					</button>
				))}
			</div>
		</div>
	</div>

	<script>
		// Image gallery functionality
		document.addEventListener('DOMContentLoaded', function() {
			const mainImage = document.getElementById('main-image');
			const modalMainImage = document.getElementById('modal-main-image');
			const photoModal = document.getElementById('photo-modal');
			const showAllPhotosBtn = document.getElementById('show-all-photos');
			const closePhotoModal = document.getElementById('close-photo-modal');
			
			// Thumbnail click handlers
			document.querySelectorAll('.thumbnail-btn').forEach(btn => {
				btn.addEventListener('click', function() {
					const imageSrc = this.getAttribute('data-image');
					mainImage.src = imageSrc;
					// Update active thumbnail
					document.querySelectorAll('.thumbnail-btn').forEach(b => b.classList.remove('border-brand-green'));
					this.classList.add('border-brand-green');
				});
			});

			// Show all photos modal
			showAllPhotosBtn.addEventListener('click', function() {
				photoModal.classList.remove('hidden');
				document.body.style.overflow = 'hidden';
			});

			closePhotoModal.addEventListener('click', function() {
				photoModal.classList.add('hidden');
				document.body.style.overflow = '';
			});

			// Modal thumbnail click handlers
			document.querySelectorAll('.modal-thumbnail').forEach(btn => {
				btn.addEventListener('click', function() {
					const imageSrc = this.getAttribute('data-image');
					modalMainImage.src = imageSrc;
					// Update active thumbnail
					document.querySelectorAll('.modal-thumbnail').forEach(b => b.classList.remove('border-brand-green'));
					this.classList.add('border-brand-green');
				});
			});

			// Close modal when clicking outside
			photoModal.addEventListener('click', function(e) {
				if (e.target === this) {
					photoModal.classList.add('hidden');
					document.body.style.overflow = '';
				}
			});
		});
	</script>
</Layout>
